<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>轻言轻语</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="./res/layui/css/layui.css">
    <link rel="stylesheet" href="./res/static/css/mian.css">
</head>

<body class="lay-blog">
    <div class="header">
        <div class="header-wrap">
            <h1 class="logo pull-left">
                <a href="activity.html" style="color:rgba(255,255,255,.8);">
                    <img src="./res/static/images/logo.png" alt="" class="logo-img">
                    轻言轻语
                </a>
            </h1>
            <form class="layui-form blog-seach pull-left" action="">
                <div class="layui-form-item blog-sewrap">
                    <div class="layui-input-block blog-sebox">
                        <i class="layui-icon layui-icon-search"></i>
                        <input type="text" name="title" lay-verify="title" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </form>
            <div class="blog-nav pull-right">
                <ul class="layui-nav pull-left ">
                    <li class="layui-nav-item layui-this"><a href="">动态</a></li>
                    <li class="layui-nav-item"><a href="friend.html">好友</a></li>
                    <li class="layui-nav-item"><a href="manage_info.html">管理</a></li>
                    <li class="layui-nav-item"><a href="https://github.com/hellolijj/neo4j_front" target="_black">关于</a></li>
                    <li class="layui-nav-item">
                        <a href=""><img src="./res/static/images/info-img.png" class="layui-nav-img">我</a>
                        <dl class="layui-nav-child">
                            <dd><a href="manage_info.html">我的</a></dd>
                            <dd><a href="javascript:logout();">退出</a></dd>
                        </dl>
                    </li>
                </ul>
            </div>

        </div>
    </div>
    <div class="container-wrap">
        <div class="container container-message container-details container-comment">
            <div class="contar-wrap">

                <div class="item">
                    <div class="item-box  layer-photos-demo1 layer-photos-demo">
                        <h3>拥有诗意的心态,才能拥有诗意的生活</h3>
                        <h5>发布于：<span>刚刚</span></h5>
                        <p>父爱如山，不善表达。回想十多年前，总记得父亲有个宽厚的肩膀，小小的自己跨坐在上面，越过人山人海去看更广阔的天空，那个时候期望自己有一双翅膀，能够像鸟儿一样飞得高，看得远。虽然父亲有时会和自己开玩笑，但在做错事的时候会受到严厉的训斥。父亲有双粗糙的大手掌，手把手教我走路、骑车，却会在该放手的时刻果断地放开让自己去大胆尝试，那个时候期望快快长大，能够做自己想做的事，不用受父亲的“控制”。父亲是智慧树，他无所不知、无所不晓，虽然你有十万个为什么，但是也难不倒他。</p>
                        <img src="../res/static/images/item.png" alt="帅哥">
                    </div>
                </div>


                <form class="layui-form" action="">
                    <div class="layui-form-item layui-form-text">
                        <textarea class="layui-textarea" id="LAY-msg-content" name="comment" style="resize:none"></textarea>
                    </div>
                </form>
                <div class="item-btn">
                    <button class="layui-btn layui-btn-normal" id="item-btn" onclick="submit_comment()">评论</button>
                </div>

                <div id="LAY-msg-box"></div>

                <script id="LAY-msg-tpl" type="text/html">
                    <div class="info-box">
                        <div class="info-item">
                            <img class="info-img" src="{{ d.avatar }}" alt="" style="width: 68px;">
                          <div class="info-text">
                                <p class="title">
                                  <span class="name">{{ d.username }}</span>
                                  <span class="info-img">
                                      {{ d.time }}
                                     </span>
                                </p>
                                <p class="info-intr">
                                    {{ d.content }}
                                </p>
                          </div>
                        </div>
                    </div>
                </script>
            </div>
        </div>
    </div>


    <div class="footer">
        <p>
            <span>&copy; 2018 - 2019</span>
            <span><a href="https://github.com/hellolijj/neo4j_front" target="_blank">github</a></span>
        </p>
        <p><span>轻言轻语 记录你的小心情</span></p>
    </div>

</body>

</html>
<script src="./res/layui/layui.js"></script>
<script src='./res/static/js/jquery.js'></script>
<script src="./res/index.js"></script>

<script>
    layui.config({
        base: './res/static/js/'
    }).use('blog');

    // 获取 dynamicid
    var url = document.location.toString();
    var arrUrl = url.split("?");
    arrUrl = arrUrl[1].split("=")
    if (arrUrl[0] != "dynamicid" && arrUrl[1] == null) {
        layer.alert("参数错误", {
            title: '错误提示'
        })
    }
    var dynamicid = arrUrl[1]

    // 加载评论
    $.get(base_usr + "/Comment/getList", { dynamic_id: dynamicid }, function (res) {
        if (res.status == 200) {
            
            layui.use('laytpl', function () {
                laytpl = layui.laytpl;
                var getTpl = document.getElementById('LAY-msg-tpl').innerHTML
                var view = document.getElementById('LAY-msg-box');
                res.data.comment_lists.forEach(e => {
                        var data = {
                            username: e.username,
                            avatar: e.avatar,
                            time: e.create_time,
                            content: e.text
                        };
                        laytpl(getTpl).render(data, function (html) {
                        $('#LAY-msg-box').prepend(html);
                    });
                });  
            });

        } else {
            layer.alert(res.message, {
                title: '错误提示'
            })
        }
    })

    // 用户评论
    function submit_comment() {
        var comments = $("#LAY-msg-content").val()

        sent_data = {
            "dynamicid": dynamicid,
            "userid": localStorage.getItem("userid"),
            "comments": comments
        }
        $.ajax({
            type: "POST",
            url: base_usr + "/Comment/create",
            contentType: "application/json",
            data: JSON.stringify(sent_data),
            success: function (res) {
                if (res.status == 200) {

                } else {
                    layer.alert(res.message, {
                        title: '错误提示'
                    })
                }
            }
        })
        return false
    }



</script>